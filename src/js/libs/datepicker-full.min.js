// Документация: https://github.com/qodesmith/datepicker

import '@scss/vendors/datepicker.scss';
import datepicker from 'js-datepicker';

const target = document.querySelector('.variants__settings-item--date');
const textTarget = target.children[0];
const workItems = Array.from(document.querySelectorAll('.item-variants'));

const picker = datepicker(target, {
  onSelect: instance => {
    const selectedDate = new Intl.DateTimeFormat('ru').format(instance.dateSelected);
    textTarget.textContent = selectedDate;

    // Видимые элементы
    const visibleItems = workItems.filter(el => !el.classList.contains('item-variants--hidden'));
    // Что ищем?
    const selectedMonth = instance.currentMonth;
    const selectedYear = instance.currentYear;
    // Определяем название фильтра
    const currentFilter =
      new Date(instance.dateSelected).getTime() - new Date(instance.startDate).getTime() <= 0
        ? 'Дом сдан'
        : selectedMonth >= 0 && selectedMonth < 3
        ? `1 квартал ${selectedYear}`
        : selectedMonth >= 3 && selectedMonth < 6
        ? `2 квартал ${selectedYear}`
        : selectedMonth >= 6 && selectedMonth < 9
        ? `3 квартал ${selectedYear}`
        : selectedMonth >= 9 && selectedMonth < 12
        ? `4 квартал ${selectedYear}`
        : null;
    // Ищем нужные элементы
    visibleItems.forEach(el => (el.dataset.date !== currentFilter ? (el.hidden = true) : null));
  },
  startDay: 1,
  customDays: ['Суб', 'Пон', 'Вт', 'Ср', 'Чт', 'Пт', 'Вс'],
  customMonths: [
    'Янв',
    'Фев',
    'Март',
    'Апр',
    'Май',
    'Июнь',
    'Июль',
    'Авг',
    'Сент',
    'Окт',
    'Ноябрь',
    'Дек',
  ],
  overlayButton: 'Поиск',
  overlayPlaceholder: 'Введите 4-значный год',
});
